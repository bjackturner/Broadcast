!        Generated by TAPENADE     (INRIA, Ecuador team)
!  Tapenade 3.16 (master) -  9 Oct 2020 17:47
!
!  Differentiation of chuproduct_2d in forward (tangent) mode (with options with!SliceDeadControl with!SliceDeadInstrs with!Stati
!cTaping):
!   variations   of useful results: product
!   with respect to varying inputs: w
!   RW status of diff variables: w:in product:out
! =============================================================================
!          Chu matrix-product 2D
! =============================================================================
!
SUBROUTINE CHUPRODUCT_2D_D(product, productd, w, wd, wf, vol, gh, mach, &
& cv, gam, rgaz, cs, muref, tref, s_suth, im, jm)
  IMPLICIT NONE
! variables for dimension -----------------------------------------
  INTEGER :: im, jm, gh
! required arguments ----------------------------------------------
! thermo
  REAL*8, INTENT(IN) :: cv, gam, rgaz
! viscosity
  REAL*8, INTENT(IN) :: cs, muref, tref, s_suth
  REAL*8, INTENT(IN) :: mach
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh), INTENT(IN) :: vol
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(IN) :: w
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5), INTENT(IN) :: wd
  REAL*8, DIMENSION(im, jm, 5), INTENT(IN) :: wf
! Returned objects ------------------------------------------------
  REAL*8, DIMENSION(im, jm, 5), INTENT(INOUT) :: product
  REAL*8, DIMENSION(im, jm, 5), INTENT(INOUT) :: productd
! Non-required arguments ------------------------------------------
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh, 5) :: f, g
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velx
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velxd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: vely
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velyd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velz
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: velzd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tloc
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: tlocd
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: p
  REAL*8, DIMENSION(1-gh:im+gh, 1-gh:jm+gh) :: mu
  INTEGER :: i, j, h
  REAL*8 :: ro, rom1, htot, eloc, ec
  REAL*8 :: rod, rom1d, elocd, ecd
  REAL*8 :: betas
  REAL*8 :: cvm1
  REAL*8 :: a1, a2, gam1
  REAL*8 :: a1d, a2d
  REAL*8 :: half, one, zero, two
  INTRINSIC SQRT
  REAL*8 :: result1
  REAL*8 :: temp
  REAL*8 :: temp0
  REAL*8 :: temp1
  REAL*8 :: temp2
  REAL*8 :: temp3
  REAL*8 :: temp4
  REAL*8 :: temp5
  REAL*8 :: temp6
  REAL*8 :: temp7
  REAL*8 :: temp8
  REAL*8 :: temp9
! -----------------------------------------------------------------
!
  half = 0.5d0
  one = 1.d0
  cvm1 = one/cv
  gam1 = gam - one
! Primitives
! for Sutherland
  velxd = 0.0_8
  velyd = 0.0_8
  velzd = 0.0_8
  tlocd = 0.0_8
  DO j=1-gh,jm+gh
!DIR$ IVDEP
    DO i=1-gh,im+gh
      rod = wd(i, j, 1)
      ro = w(i, j, 1)
      rom1d = -(one*rod/ro**2)
      rom1 = one/ro
      velxd(i, j) = rom1*wd(i, j, 2) + w(i, j, 2)*rom1d
      velx(i, j) = w(i, j, 2)*rom1
      velyd(i, j) = rom1*wd(i, j, 3) + w(i, j, 3)*rom1d
      vely(i, j) = w(i, j, 3)*rom1
      velzd(i, j) = rom1*wd(i, j, 4) + w(i, j, 4)*rom1d
      velz(i, j) = w(i, j, 4)*rom1
!
      ecd = half*(2*velx(i, j)*velxd(i, j)+2*vely(i, j)*velyd(i, j)+2*&
&       velz(i, j)*velzd(i, j))
      ec = half*(velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j)+velz(i, j)*&
&       velz(i, j))
! ec  = HALF*( velx(i,j)*velx(i,j) &
!            + vely(i,j)*vely(i,j))
!
      temp = w(i, j, 5) - ec*ro
      elocd = rom1*(wd(i, j, 5)-ro*ecd-ec*rod) + temp*rom1d
      eloc = temp*rom1
!
      tlocd(i, j) = cvm1*elocd
      tloc(i, j) = eloc*cvm1
!
!  p(i,j)  = ro*rgaz*tloc(i,j)
!h(i,j,1)  = w(i,j,4)
!h(i,j,2)  = w(i,j,4) * velx(i,j)
!h(i,j,3)  = w(i,j,4) * vely(i,j)
!h(i,j,4)  = w(i,j,4) * velz(i,j) + p(i,j)
!h(i,j,5)  = w(i,j,4) * htot
    END DO
  END DO
  productd = 0.0_8
! Work on interior domain minus one cell
  DO j=1,jm
!DIR$ IVDEP
    DO i=1,im
      temp = gam1*gam*(mach*mach)
      temp0 = w(i, j, 1)/tloc(i, j)
      a1d = temp*(wd(i, j, 1)-temp0*tlocd(i, j))/tloc(i, j)
      a1 = temp*temp0
      temp0 = (half*(velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j))-cv*&
&       tloc(i, j))/w(i, j, 1)
      a2d = (half*(2*velx(i, j)*velxd(i, j)+2*vely(i, j)*velyd(i, j))-cv&
&       *tlocd(i, j)-temp0*wd(i, j, 1))/w(i, j, 1)
      a2 = temp0
      temp0 = half*vol(i, j)
      temp = (velx(i, j)*velx(i, j)+vely(i, j)*vely(i, j))/w(i, j, 1)
      temp1 = gam*(mach*mach)
      temp2 = temp1*w(i, j, 1)
      temp3 = tloc(i, j)/temp2
      temp4 = velx(i, j)/w(i, j, 1)
      temp5 = a1*a2/w(i, j, 1)
      temp6 = vely(i, j)/w(i, j, 1)
      productd(i, j, 1) = temp0*(wf(i, j, 1)*((2*velx(i, j)*velxd(i, j)+&
&       2*vely(i, j)*velyd(i, j)-temp*wd(i, j, 1))/w(i, j, 1)+(tlocd(i, &
&       j)-temp3*temp1*wd(i, j, 1))/temp2+a2**2*a1d+a1*2*a2*a2d)-wf(i, j&
&       , 2)*(temp4*(a2*a1d+a1*a2d)+(one+a1*a2)*(velxd(i, j)-temp4*wd(i&
&       , j, 1))/w(i, j, 1))+wf(i, j, 5)*(a2*a1d+a1*a2d-temp5*wd(i, j, 1&
&       ))/w(i, j, 1)-wf(i, j, 3)*(temp6*(a2*a1d+a1*a2d)+(one+a1*a2)*(&
&       velyd(i, j)-temp6*wd(i, j, 1))/w(i, j, 1)))
      temp6 = half*vol(i, j)
      temp5 = one/w(i, j, 1)
      temp4 = w(i, j, 1)*w(i, j, 1)
      temp3 = velx(i, j)*velx(i, j)
      temp2 = temp3*a1/temp4
      temp1 = velx(i, j)/w(i, j, 1)
      temp0 = w(i, j, 1)*w(i, j, 1)
      temp = velx(i, j)*a1
      temp7 = temp*vely(i, j)/temp0
      temp8 = w(i, j, 1)*w(i, j, 1)
      temp9 = velx(i, j)*a1/temp8
      productd(i, j, 2) = temp6*(wf(i, j, 2)*((a1*2*velx(i, j)*velxd(i, &
&       j)+temp3*a1d-temp2*2*w(i, j, 1)*wd(i, j, 1))/temp4-temp5*wd(i, j&
&       , 1)/w(i, j, 1))-wf(i, j, 1)*(temp1*(a2*a1d+a1*a2d)+(one+a1*a2)*&
&       (velxd(i, j)-temp1*wd(i, j, 1))/w(i, j, 1))+wf(i, j, 3)*(vely(i&
&       , j)*(a1*velxd(i, j)+velx(i, j)*a1d)+temp*velyd(i, j)-temp7*2*w(&
&       i, j, 1)*wd(i, j, 1))/temp0-wf(i, j, 5)*(a1*velxd(i, j)+velx(i, &
&       j)*a1d-temp9*2*w(i, j, 1)*wd(i, j, 1))/temp8)
      temp9 = half*vol(i, j)
      temp8 = w(i, j, 1)*w(i, j, 1)
      temp7 = velx(i, j)*a1
      temp6 = temp7*vely(i, j)/temp8
      temp5 = vely(i, j)/w(i, j, 1)
      temp4 = one/w(i, j, 1)
      temp3 = w(i, j, 1)*w(i, j, 1)
      temp2 = vely(i, j)*vely(i, j)
      temp1 = temp2*a1/temp3
      temp0 = w(i, j, 1)*w(i, j, 1)
      temp = vely(i, j)*a1/temp0
      productd(i, j, 3) = temp9*(wf(i, j, 2)*(vely(i, j)*(a1*velxd(i, j)&
&       +velx(i, j)*a1d)+temp7*velyd(i, j)-temp6*2*w(i, j, 1)*wd(i, j, 1&
&       ))/temp8-wf(i, j, 1)*(temp5*(a2*a1d+a1*a2d)+(one+a1*a2)*(velyd(i&
&       , j)-temp5*wd(i, j, 1))/w(i, j, 1))+wf(i, j, 3)*((a1*2*vely(i, j&
&       )*velyd(i, j)+temp2*a1d-temp1*2*w(i, j, 1)*wd(i, j, 1))/temp3-&
&       temp4*wd(i, j, 1)/w(i, j, 1))-wf(i, j, 5)*(a1*velyd(i, j)+vely(i&
&       , j)*a1d-temp*2*w(i, j, 1)*wd(i, j, 1))/temp0)
      temp9 = half*vol(i, j)
      temp8 = one*wf(i, j, 4)/w(i, j, 1)
      productd(i, j, 4) = -(temp9*temp8*wd(i, j, 1)/w(i, j, 1))
      temp9 = half*vol(i, j)
      temp8 = a1*a2/w(i, j, 1)
      temp7 = w(i, j, 1)*w(i, j, 1)
      temp6 = velx(i, j)*a1/temp7
      temp5 = w(i, j, 1)*w(i, j, 1)
      temp4 = w(i, j, 1)*w(i, j, 1)
      temp3 = vely(i, j)*a1/temp4
      productd(i, j, 5) = temp9*(wf(i, j, 1)*(a2*a1d+a1*a2d-temp8*wd(i, &
&       j, 1))/w(i, j, 1)-wf(i, j, 2)*(a1*velxd(i, j)+velx(i, j)*a1d-&
&       temp6*2*w(i, j, 1)*wd(i, j, 1))/temp7+wf(i, j, 5)*(a1d-a1*2*w(i&
&       , j, 1)*wd(i, j, 1)/temp5)/temp5-wf(i, j, 3)*(a1*velyd(i, j)+&
&       vely(i, j)*a1d-temp3*2*w(i, j, 1)*wd(i, j, 1))/temp4)
    END DO
  END DO
END SUBROUTINE CHUPRODUCT_2D_D
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

